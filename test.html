<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/morgengrauen.css" media="screen">
<link rel="stylesheet" type="text/css" href="css/WebTelnet.css" media="screen">

<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />
<title>MorgenGrauen - mg.mud.de - das gr&ouml;&szlig;te deutsche textbasierte, kostenlose Online-Rollenspiel</title>


	<link rel="stylesheet" type="text/css" href="css/startseite.css" media="screen">
	<link type="text/css" href="css/jquery-ui.css" rel="stylesheet"/>

	<style type="text/css">
	  <!--
	  #nav .secnav { display: block;}
	  #nav #nav_start { color:#043341;}
	  -->
	</style>

	<style type="text/css">
	.bg_green { background-color : green;}
	.bg_yellow {  background-color : yellow;}
	.bg_red { background-color : red;}
	.teamlead { border : 2px solid green;}
	</style>
	<script type="text/javascript" src="js/coffeescript/coffee-script.js"></script>
	<script type="text/javascript" src="js/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery/jquery-ui.min.js"></script>
	<script type="text/javascript" src="js/mg_client/base.js"></script>
	<script type="text/javascript" src="js/mg_client/ansi.js"></script>
	<script type="text/javascript" src="js/mg_client/mg_client_ui.js"></script>
	<script type="text/javascript" src="js/mg_client/mg_client.js"></script>
	<script type="text/javascript" src="js/mg_client/mg_client_io.js"></script>
	<script type="text/javascript" src="js/mg_client/mg_client_player.js"></script>
	<script type="text/javascript" src="js/mg_client/mg_client_history.js"></script>
	<script type="text/coffeescript" src="js/mg_client/mg_client_mpa.coffee"></script>
	<script type="text/javascript" src="js/mg_client/mg_client_config.js"></script>
	<script type="text/javascript" src="js/persist/persist-min.js"></script>
	<script type="text/javascript" src="js/mg_client/mg_client_persist.js"></script>
	<script type="text/javascript" src="js/datatables/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="js/edit_area/edit_area_full.js"></script>
	<script type="text/javascript">
	
    function enrich(line) {
		line = escapeHTML(line);

		if (handlePassword(line)) {
			return line;
		}

		beforeLine();

		grab_battle(line);

		line = runTriggers(line);
		
		line = color_escapes(line);

		line = line.replace(/\b(norden|nordosten|osten|suedosten|sueden|suedwesten|westen|nordwesten|oben|unten|raus)\b/g,"<span style='color:red' onclick='input(\"$1\");'>$1</span>");
		line = line.replace(/([A-Z][a-z]{2,})/g,"<span ondblclick='input(\"untersuche $1\");'>$1</span>");
		
		grab_source(line);
		
		afterLine();
		return line;
	}

	$(document).ready(function(){
//		try {
		loadAllScripts();
		addScript("skript",function(name,commands){ 
			commands = Array.prototype.slice.call(arguments);
			commands.shift();
			var script=commands.join(" ");
			addScript(name, "function() { "+script+" }");
		});
		
		add_player_connect_triggers(); // todo move to startup script
		
		$('#debug_trigger').dialog({title:"Debug Trigger", position: [850,600], width: 400, autoOpen : false});
		$('#input').keydown(handle_keys);

		addBox("p_fight","Kampf");
		addBox("source","Source");

		add_button("Info","info");
		add_button("Inventory","inv");
		add_button("nn","nn");
		add_button("Ausruestung","ausruestung");

		$( "#b_grafik" ).button().click(function() { 
		   input("grafik aus"); 
		});
		$( "#b_modus" ).buttonset();
		showPlayer();
		addWindow("Spieler",
				{ p_info: { 
				title: "Info", start:/- .+ -{3,}$/, addStart:true, 
				end: /----------------------------------------------------------------------/ },
				  p_inventory : { title: "Inventory", start : /^(inv|inventory|i)\s*$/ },
				  p_ausruestung : { title: "Ausr&uuml;stung", start : /^(ar|ausruestung)\s*$/ ,
					fun : function(text) { setTabText("p_ausruestung",color_escapes(escapeHTML(text))) }
				 }
				});
		addWindow("Mud", {
			p_ort : { title: "Ort", 	start : /^(schaue?|l|look|norden|nordosten|osten|suedosten|sueden|suedwesten|westen|nordwesten|oben|unten|raus|n|nw|no|o|s|w|sw|so|ob|u)\s*$/},
			p_finger : { title: "Finger", start : /^.+ ist anwesend,$/ , addStart:true},
			p_kwer : { title : "Anwesende", start: /^     Liste der Mitspieler vom/, addStart:true },
			p_team : { title : "Team" , start: /^  Name        Gilde           LV GLV  LP (MLP)  KP (MKP) Vors. GR AR TR FR A V/ }});
		addWindow("Kommunikation", {
			teilemit : { title : "Mitteilungen", trigger : /^(Du teilst .+ mit|.+ teilt Dir mit):/ , 
			fun : function (text) { appendTabText("teilemit",text); } },
			ebenen :   { title : "Ebenen", trigger : /^\[[A-Z]\w+/, fun : function (text) { appendTabText("ebenen",text); }}
		})		
		
		editAreaLoader.init({
			  id : "script_editor"
			, syntax: "js"		
			, start_highlight: false
			, allow_toggle : false
			, replace_tab_by_spaces : true
			, word_wrap : true
			, display: "onload"
			, toolbar : "new_document, load, save , | , search, go_to_line, |, undo, redo"
			, save_callback : "scriptDialog"
			, load_callback : "scriptDialog"

		});
		$("#script_editor").dialog({autoOpen : false ,width : $("#script_editor").width() });
			
		runScript("startup");
		runHooks("startup");
		
		$('#mpa_rubriken').dataTable( { bJQueryUI: true, // aaData: [["1","allgemeines"]],  
		aoColumns: [ { sTitle: "Nr", sWidth : "3em" }, 
		             { sTitle: "Rubrik", sWidth : "20em", fnRender: function(obj) {
							var data = obj.aData[ obj.iDataColumn ];
							return "<span onClick='send(\"inhalt "+data+"\",true)'>"+data+"</span>";
						} },
					 { sTitle: "Anzahl", sWidth : "4em" }, 
					 { sTitle: "Letzte", sWidth : "10em" } ] } );
		$('#mpa_rubrik').dataTable( { bJQueryUI: true, // aaData: [["1","allgemeines"]],  
		aoColumns: [ { sTitle: "Nr", sWidth : "3em" }, 
		             { sTitle: "Titel", sWidth : "20em", fnRender: function(obj) {
						    var id = obj.aData[ 0 ];
							var data = obj.aData[ obj.iDataColumn ];
							var rubrik = $('#mpa_rubrik_tab_name').text();
							return "<span onClick='liesArtikel(\""+rubrik+"\","+id+")'>"+data+"</span>";
						} },
					 { sTitle: "Autor", sWidth : "10em" }, 
					 { sTitle: "Antworten", sWidth : "10em", fnRender: function(obj) {
						    var id = obj.aData[ 0 ];
							var data = obj.aData[ obj.iDataColumn ];
							var rubrik = $('#mpa_rubrik_tab_name').text();
							return data + "<input type=\"submit\" onClick='writeArticle(\""+rubrik+"\","+id+")' value='Antworten'/>";
					} },
					 { sTitle: "Datum", sWidth : "10em" }
					 ] } );
		$('#mpa').tabs().draggable().resizable(); // .dialog({ title: "MPA", width: 600});
		add_close_button($('#mpa'))
//		addScript("startup", function(x) { alert("test "+x)});
//		editScript("startup");
		$('#input').focus();
//	} catch(e) {console.log(e);throw e;}
	});
	var	server = connect(showText);
	console.log(server);
	</script>
</head>
<body style="font-size:10px;height:100%;">
	<div id="nav" style="left: 700px; top: 75px; position: absolute;">
	  <div class="nav-1">&nbsp;</div>

	  <div class="nav-2" style="font-size:12px;">
	 <a href="#" class="nav" id="nav_start" style="margin-top:0;">Fenster</a>
	  <span id="nav_sub_start" class="secnav">
	  <a href="#" id="nav_eingang" onclick="$('#status').dialog('open'); return false;">Status</a>
	  <a href="#" id="nav_eingang" onclick="$('#mpa').show(); return false;">MPA</a>
	</span>

  	<a href="#" class="nav" id="nav_neues">Makros</a>
  	<span class="secnav">
    	<a href="#" class="nav" onclick="scriptDialog('edit'); return false;">Edit</a>
    	<a href="#" class="nav" onclick="editScript('startup'); return false;">Startup</a>
    	<a href="#" class="nav" onclick="editScript('connect'); return false;">Connect</a>
	  	<a href="#" class="nav" onclick="$('#debug_trigger').dialog('open'); return false;">Debug Trigger</a>
  	</span>

	  </div>

	  <div class="nav-3">&nbsp;</div>
	</div>

	<div id="ie-hack">&nbsp;</div>
	<div id="doc">
		
	<div id="mgbox" style="overflow-x:hidden;overflow-y:auto;height:450px;width:48em;line-height:1.2em;font-size:12px;margin-top:-40px;margin-left:-100px;" class="mudtext">
		<div id="mg-logo" style="margin-top:-12px;margin-left:-390px;">&nbsp;</div>
		<pre id="out"></pre>
	</div>

	<div style="margin-left:-100px;margin-top:5px;">

	<span id="toolbar" class="ui-widget-header ui-corner-all">
		<input type="checkbox" id="b_grafik" /><label for="b_grafik">Grafik aus</label>

		<span id="b_modus">
			<input type="radio" id="b_lang" name="b_modus" onchange="input('lang');"/><label for="b_lang">Lang</label>
			<input type="radio" id="b_kurz" name="b_modus"  onchange="input('kurz');" checked="checked" /><label for="b_kurz">Kurz</label>
			<input type="radio" id="b_ultrakurz" name="b_modus"  onchange="input('ultrakurz');"/><label for="b_ultrakurz">Ultrakurz</label>
		</span>
	</span>

	<form id="form" method="post"  style="margin: 5px;" onsubmit="try { sendInput()} catch(e) { alert(e); };return false;">
		<input type="text" id="input" style="width:50em;font-family:monospace;font-size:12px;" onKeyPress="return submitEnter(this,event)"/>
		<input type="password" id="password" style="width:50em;font-family:monospace;font-size:12px;display:none" onKeyPress="return submitEnter(this,event)"/>
	</form>

    </div>

	<div class="ie-hack2">&nbsp;</div>
	</div>
    <textarea id="script_editor" cols="80" style="display:none"></textarea>
	<div id="disclaimer"><span style="text-align:center;">&copy; MorgenGrauen. Alle Rechte vorbehalten.</span></div>
    <form id="script_dialog" onsubmit="scriptDialogSubmit();return false;" style="display:none">
		<input type="text" name="new_script_name" style="width:100px;"/><br/>
		<select name="script_name" size="10" style="width:100px;">
		</select><br/>
		<input type="submit" value="Save">
	</form>
	<div id="debug_trigger">
		<textarea rows="10" cols="78" id="debug_trigger_test"></textarea>
		<input type="submit" value="test" onClick="showText($('#debug_trigger_test').val());false;">
	</div>
	
	<div id="mpa">
		<ul>
			<li><a href="#tab-mpa-rubriken">Rubriken</a></li>
			<li><a id="mpa_rubrik_tab_name" href="#tab-mpa-rubrik">Allgemein</a></li>
			<li><a id="mpa_artikel_tab_name" href="#tab-mpa-artikel">Artikel</a></li>
		</ul>
		<div id="tab-mpa-rubriken">
			<input type="submit" onClick="writeArticle()" value="Verfassen"/>
		<table cellpadding="0" cellspacing="0" border="0" class="display" id="mpa_rubriken"></table>
		</div>
		<div id="tab-mpa-rubrik">
			<input type="submit" onClick="writeArticle($('#mpa_rubrik_tab_name').text())" value="Verfassen"/>
		<table cellpadding="0" cellspacing="0" border="0" class="display" id="mpa_rubrik"></table>
		</div>
		<div id="tab-mpa-artikel">
			Rubrik: <span id="mpa_artikel_rubrik"></span>
			Nummer: <span id="mpa_artikel_id"></span>
			Titel: <span id="mpa_artikel_titel"></span>
			Autor: <span id="mpa_artikel_autor"></span>
			Datum: <span id="mpa_artikel_date"></span>
			<input type="submit" onClick="writeArticle($('#mpa_artikel_rubrik').text(), $('#mpa_artikel_id').text())" value="Antworten"/>
			<pre style="overflow:auto" id="mpa_artikel_text"></pre>
	    </div>
	</div>
	
</body>
</html>